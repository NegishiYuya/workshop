## Docker の概要

### Docker とは

Docker 社が開発している、コンテナ型の仮想環境を作成、配布、実行するためのプラットフォームである。
([Docker 入門（第一回）～ Docker とは何か、何が良いのか～ | さくらのナレッジ](https://knowledge.sakura.ad.jp/13265/) より引用)

「コンテナ」「仮想環境」という言葉がキーワードとなる。
「仮想環境」という言葉より開発環境を構築するためのものとイメージされるが、
開発環境だけでなく本番運用環境などでも使用される技術である。

### Docker のメリットとその原理

-   どの OS に対しても同じ環境を構築することができる
    -   Docker は linux 上でのみ動く。だが、Windows や Mac でも Docker のクライアントソフトである`DockerDesktop`をインストールすることで linux がインストールされる。
        -   そのことによって、Linux でも Windows でも Mac でも`linux上でDockerを動かす`ことができる。
        -   参考：[Windows10 に Docker Desktop for Windows をいれて Linux コンテナで動かす手順（基本編） - Code for final](https://final.hateblo.jp/entry/2020/05/04/192231)
    -   開発環境・受入用環境・本番環境のサーバの OS が異なっていても、Docker がインストールされていれば、それぞれ同じ環境を構築することができる。
-   複数人での開発を進める際に、同じ環境を構築することができる。配布しやすい。
    -   仮想環境である「コンテナ」はイメージやファイル(Dockerfile)の形式で永続化することができる。イメージやファイルを配布して、各々環境でコンテナを作成・起動することで一様な環境を構築することができる。
        -   イメージは DockerHub や AWS 上の ECR といったリポジトリで管理することができる。
        -   Dockerfile は Git などのリポジトリで管理することができる。
-   1 つの端末に異なるバージョンのミドルウェアを共存させることができる
    -   1 つ 1 つのコンテナはそれぞれ独立した環境であるため、コンテナごとにバージョン違いのミドルウェアを入れていけばよい。
        -   A プロジェクトでは Java7 が必要、B プロジェクトでは Java11 が必要という場合に、端末自体に Java7 か Java11 を入れてしまうと入れ替えが必要になる(共存ができないということ)
            -   この場合、A プロジェクト用の Java7 が入ったコンテナ、B プロジェクト用の Java11 が入ったコンテナをそれぞれ用意すればよい。
-   構築して捨てる、構築する…がしやすい
    -   上記したようにイメージや Dockerfile からの環境構築が容易なため、構築して捨てる、構築する…の試行錯誤がしやすい。

---

### Dockerfile、イメージ、コンテナについて

イメージは環境を作るための「ひな形」、コンテナは環境そのものである。  
Java などのオブジェクト指向言語でいうところの「クラス」と「インスタンス」の関係に近い。
イメージを使うことで複数のコンテナを簡単に作成し、起動することができる。

イメージは Dockerfile やコマンドを使ってビルドすることによって、生成できる。  
そのため、Dockerfile を配布して各々環境でビルドすることによって、一様の環境を多くの人に配布することができる。  
また、汎用的な環境のイメージは DockerHub から pull することができる。また、自作のイメージを DockerHub に push することもできる。

---

### コマンドからイメージを pull し、コンテナを起動する例

コマンドの詳細は割愛。

-   DockerHub にある、nginx のイメージを使い、`test-nginx`というコンテナを作成し、起動する。  
    8080 番ポートで受け付ける。  
    以下のコマンドを実行後、`http://localhost:8080/`にアクセスすると nginx のサンプルページが表示される。

```
docker run --name test-nginx -d -p 8080:80 nginx
```

-   DockerHub にある、wordpress のイメージを使い、`test-wordpress`というコンテナを作成し、起動する。  
    8081 番ポートで受け付ける。  
    以下のコマンドを実行後、`http://localhost:8081/`にアクセスすると wordpress の初期設定画面が表示される。  
    DB 以外の wordpress を動かすために必要なソフトウェアが一通りインストールされた環境が出来上がる。

```
docker run --name test-wordpress -d -p 8081:80 wordpress
```

-   DockerHub にある、mysql のイメージを使い、`test-mysql`というコンテナを作成し、起動する。  
    以下のコマンドを実行後、MySQL のクライアントツール(例.MySQLWorkBench など)でホストに`localhost`、ポート番号に`3306`、username に`root`、パスワードに{任意のパスワード}を指定して接続できる。

```
docker run --name test-mysql -d -e MYSQL_ROOT_PASSWORD={任意のパスワード} -p 3306:3306 mysql
```
