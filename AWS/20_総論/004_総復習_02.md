## 総復習 02

### 前提

-   ハンズオンで使用するリソースはすべて東京リージョンにあります。
-   リソースを作成する場合も東京リージョンに作成してください。
-   【ハンズオン】の問題の解答は手順を記載します。
    -   AWS コンソールにログインする手順は省略します。

---

### 問 1

RDS の可用性を向上させる方法を 2 つ答えてください。

#### 解答

-   マルチ AZ 構成をとる
-   リードレプリカを使用する

---

### 問 2

RDS のコスト効率を向上させる方法を 1 つ答えてください。

#### 解答

Reserved Instance で購入する

---

### 問 3

RDS のパラメーターグループを変更する際の注意点を答えてください。

#### 解答

変更対象のパラメータの`適用タイプ`が`静的`の場合は、変更後 RDS の再起動をする必要がある。

---

### 問 4

RDS の停止についてコスト観点での注意点を答えてください。

#### 解答

停止後 1 週間後に再起動してしまうので、再度停止させる必要がある。

---

### 問 5 　

Aurora は「何か」が 3AZ、1AZ につき 2 か所複製されるため可用性が高い。  
「何か」とは何でしょうか。

#### 解答

ストレージ

---

### 問 6

【ハンズオン】  
作成済みの RDS`workshop0830`からスナップショットを作成してください。

#### 解答

-   サービスのメニューから`RDS`を選択
-   画面左側のメニューより`データベース`を選択
-   スナップショット取得対象の RDS`workshop0830`の詳細を開く
-   画面右上のボタン`アクション`を押下し、`スナップショットの取得`を選択
-   `スナップショット名`を入力し、オレンジのボタン`スナップショットの取得`を押下

---

### 問 7

ロードバランサーを使うことによるメリットを耐障害性の観点で述べてください。

#### 解答

-   負荷分散ができる。
-   障害が発生しているインスタンスへのルーティングがされない。

---

### 問 8

ロードバランサーのターゲットグループとして、ECS で起動したコンテナを紐づけたい。  
この時に選択すべきロードバランサーはどれでしょうか。

#### 解答

Application Load Balancer(ALB)

---

### 問 9

【ハンズオン】  
以下の仕様のロードバランサーとターゲットグループを作成してください。  
ロードバランサー作成後に、ロードバランサーの DNS にブラウザにアクセスし、  
2 つの EC2 インスタンスへと接続が振り分けられることをブラウザから確認してください。  
(2 つの EC2 インスタンスには異なる HTML を格納しています)

#### ターゲットグループ

-   名前：`workshop0830targetgroup`
-   プロトコル: `HTTP`
-   登録対象の EC2 インスタンス
    -   `workshop0830-1a`
    -   `workshop0830-1c`

#### ロードバランサー

-   ロードバランサーの種類: `Application Load Balancer`
-   ロードバランサーの名前: `workshop0830lb`
-   アベイラビリティーゾーン
    -   `ap-northeast-1a`
    -   `ap-northeast-1c`
-   セキュリティグループ : `httpSgForWorkshop`
-   ターゲットグループ
    -   ターゲットグループ : `既存のターゲットグループ`
    -   名前：`workshop0830targetgroup`

#### 解答

事前準備

-   サービスのメニューから`EC2`を選択
-   画面左側のメニューより`インスタンス`を選択
-   登録対象の EC2 インスタンス 2 台を起動
    -   `workshop0829-1a`
    -   `workshop0829-1c`

ターゲットグループの作成

-   サービスのメニューから`EC2`を選択
-   画面左側のメニューより`ターゲットグループ`を選択
-   オレンジのボタン`Create target group`を押下
-   遷移後の画面で以下を設定し、オレンジのボタン`Next`を押下
    -   `Target group name` : `workshop0830targetgroup`
-   `Available instances`から登録対象のインスタンス 2 台を選択し、`Include as pending below`を押下
-   `Targets`に登録対象のインスタンス 2 台が入っていることを確認し、オレンジのボタン`Create target group`を押下
-   一覧画面に作成成功のメッセージが表示される

ロードバランサーの作成

-   サービスのメニューから`EC2`を選択
-   画面左側のメニューより`ロードバランサー`を選択
-   水色のボタン`ロードバランサーの作成`を押下
-   遷移後の画面で`Application Load Balancer`の枠内の水色のボタン`作成`を押下
-   遷移後の画面で以下を設定し、`次の手順: セキュリティ設定の構成`を押下
    -   `名前` : `workshop0830lb`
    -   `アベイラビリティーゾーン` (以下をチェック。各 AZ に作られているデフォルトのサブネットを使用)
        -   `ap-northeast-1a`
        -   `ap-northeast-1c`
-   遷移後の画面で、`次の手順: セキュリティグループの設定`を押下
-   遷移後の画面で以下を設定し、`次の手順: ルーティングの設定`を押下
    -   `セキュリティグループの割り当て` : `既存のセキュリティグループを選択する` `httpSgForWorkshop`
-   遷移後の画面で以下を設定し、`次の手順: ターゲットの登録`を押下
    -   `ターゲットグループ` : `既存のターゲットグループ`
    -   `名前` : `workshop0830targetgroup`
-   遷移後の画面で、`次の手順: 確認`を押下
-   遷移後の画面で、作成の内容を確認し、水色のボタン`作成`を押下
-   作成後、一覧にて`workshop0830lb`の状態が`Active`になることを確認(1 分程度かかる)

疎通確認

-   以下の URL に数回アクセスする
    -   `http://{作成した LB の DNS 名}/
-   表示されるページ内に記載されている AZ が切り替わることを確認する

---

### 問 10

【ハンズオン】  
以下の仕様の CloudWatch アラームを作成してください。

-   アラーム名 : `workshop0830-alerm`
-   メトリクスの取得対象の EC2 : `workshop0830-1a`
-   条件
    -   1 分間の`CPU利用率(CPUUtilization)`の最大値が 2 より大きい
-   アラーム名 : `workshop0830-ec2-alert`
-   通知アクション : アラーム状態のときに SNS トピック`workshop0830-ec2-alert-sns`にメッセージを送る

#### 解答

事前準備

-   サービスのメニューから`EC2`を選択
-   画面左側のメニューより`インスタンス`を選択
-   モニタリング対象の EC2 インスタンス`workshop0830-1a`の詳細モニタリングを有効にする

アラームの作成

-   サービスのメニューから`CloudWatch`を選択
-   画面左側のメニューより`アラーム`を選択
-   オレンジのボタン`アラームの作成`を押下
-   遷移後の画面で以下を設定し、オレンジのボタン`次へ`を押下
    -   `メトリクスの選択`(以下を選択)
        -   `EC2` > `インスタンス別メトリクス` > `workshop0830-1a`の`CPUUtilization`
    -   `期間` : `1分`
    -   `統計` : `最大値`
    -   `条件` `... よりも` : `2`
-   遷移後の画面で以下を設定し、オレンジのボタン`次へ`を押下
    -   通知
        -   `アラーム状態トリガー` : `アラーム状態`
        -   `SNS トピックの選択` : `既存の SNS トピックを選択`
        -   `通知の送信先` : `workshop0830-ec2-alert-sns`
-   遷移後の画面で以下を設定し、オレンジのボタン`次へ`を押下
    -   `アラームの名前` : `workshop0830-alerm`

---

### 問 11

あるシステムではアプリケーションのログを EC2 に保存している。  
EC2 自体に障害が発生しても、ログの取得ができるようにしたい。  
この時に有効な機能は何か。

#### 解答

CloudWatchLogs

---

### 問 12

【ハンズオン】  
Amazon EventBridge を使って、  
EC2 `workshop0830-1d` を起動する Lambda `workshop0830-start-ec2` を  
毎日 19:00 に実行できるようにしてください。

#### 参考

-   [ルールのスケジュール式 - Amazon CloudWatch Events](https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/events/ScheduledEvents.html)
-   [Amazon CloudWatch Events で cron 式を使う場合は時差に気をつける - Qiita](https://qiita.com/niwasawa/items/6e0b191d6aa21213c7ec)

#### 解答

-   サービスのメニューから`CloudWatch`を選択
-   画面左側のメニューより`イベント`を選択
-   水色のボタン`ルールの作成`を押下
-   遷移後の画面で以下を設定し、水色のボタン`設定の詳細`を押下
    -   `イベントソース`
        -   `スケジュール`を選択
        -   `cron式`を選択し、以下を記載する
            -   `0 10 * * ? *`
                -   日本時間とグリニッジ標準時の時差を考慮すること！
                -   末尾に空白などが入ると設定エラーになるので注意。cron 式から実行スケジュールのプレビューが表示されるので、それを確認すること。
    -   `ターゲット`
        -   `Lambda 関数`を選択
            -   `関数`に`workshop0830-start-ec2`を選択
-   遷移後の画面で以下を設定し、水色のボタン`ルールの作成`を押下
    -   `名前` : 任意

---
