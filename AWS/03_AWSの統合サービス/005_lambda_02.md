## 目次

-   前回までの復習
-   AWS Lambda

## 前回までの復習

---

### 問題 1

Lambda の料金体系について答えてください。  
無料利用枠についても言及してください。

#### 解答

従量課金であり、1 か月につき 100 万リクエストまでは無料

---

### 問題 2

Lambda で実行される関数を WebAPI として使用したい。  
組み合わせて使う AWS の機能はなんというか。

#### 解答

APIGateway

---

### 問題 3

Lambda で実行される関数を 定時実行させたい。  
組み合わせて使う AWS の機能はなんというか。

#### 解答

EventBridge

---

### 問題 4

Lambda を使って AWS のほかの機能のリソースにアクセスする際の注意点を述べてください。

#### 解答

Lambda 関数に紐づくロールに対して、アクセス権限を付与する。

---

## Amazon Lambda

[AWS Cloud Practitioner Essentials (Second Edition) (Japanese): M3 – AWS の統合サービス | AWS トレーニングと認定](https://www.aws.training/Details/eLearning?id=34402) 動画内の項目 `Amazon Lambda`より

### ハンズオン

#### 成果物

-   S3 にファイルが投入されたときに特定の文字列をログ出力させる関数
-   S3 にファイルが投入されたときにファイルをコピーする関数

#### 手順

1.  関数を作成する

-   サービスの一覧より`AWS Lambda`を選択
-   左に表示されるメニューから`関数`を選択
-   オレンジのボタン`関数を作成`を押下
-   画面内の以下を選択・入力(記載のない項目は変更不要)
    -   関数の作成 : `一から作成`
    -   関数名 : `lambdaTest20210524`
    -   ランタイム ：`python3.8`
-   オレンジのボタン`関数を作成`を押下
-   この状態で`Hello from Lambda!`というレスポンスを返す関数ができる

2. 作成した関数を動かしてみる

-   オレンジのボタン`Test`を押下
-   `テストイベントの設定`のウインドウが表示されるため、以下のように修正する
    -   イベント名：`testEvent20210524`
    -   エディタの中身：`{}`
-   オレンジのボタン`作成`を押下
-   オレンジのボタン`Test`を押下
-   実行結果が出力されることを確認する
-   python のコード内を添付`005_lambda_function_001.py`の内容に差し替える
-   白のボタン`Deploy`を押下
-   ボタン横に緑背景白抜き文字で`Changes Deployed`という文言が出ることを確認する
-   オレンジのボタン`Test`を押下
-   実行結果として出力されるメッセージが変わっていることを確認する

3. S3 へのファイルアップロードを関数実行のトリガーに設定する

-   `関数の概要`エリア内の`トリガーを追加`を押下
-   画面内の以下を選択・入力(記載のない項目は変更不要)
    -   トリガーの設定：`S3`
    -   バケット：`workshop0524`
    -   イベントタイプ：`すべてのオブジェクト作成イベント`
    -   プレフィックス：`targets`
    -   サフィックス：`.txt`
    -   再起呼び出しの欄：チェックを入れる
-   別タブで S3 のメニューを開く
-   S3 バケット`workshop0524`の`target`配下に任意のテキストファイルをアップロードする

4. 実行の確認をする

-   再度 Lambda に戻り、画面中ほどの`モニタリング`を押下
-   `ログ`を押下
-   TimeStamp 列を見て、ファイル投入したタイミングに近い行の`LogStream`を押下
-   `ファイルがアップロードされました`と出力されている行があることを確認

5. ファイルをコピーする関数を作る

-   python のコード内を添付`005_lambda_function_002.py`の内容に差し替える
-   白のボタン`Deploy`を押下
-   S3 バケット`workshop0524`の`target`配下に任意のテキストファイルをアップロードする
-   ログより権限エラーによって、実行が失敗していることを確認する

6.  関数に対して S3 へのアクセス権限を付与する

-   Lambda の画面中ほどの`設定`を押下
-   左側に表示される`アクセス権限`を押下
-   `実行ロール`エリアに表示されるロール名のリンクを押下
-   遷移先の IAM の画面にて画面中ほどに表示されるポリシーの一覧上部の青いボタン`ポリシーをアタッチします`を押下
-   一覧より`AmazonS3FullAccess`を選択してアタッチする

7. 実行の確認をする

-   S3 バケット`workshop0524`の`target`配下に任意のテキストファイルをアップロードする
-   S3 バケット`workshop0524`にフォルダ`outputs`ができていて、配下にアップしたテキストファイルがあることを確認する
-   ログに実行が成功していることを確認する

## 次回以降の内容

-   次回：Amazon Simple Notification Service （SNS）
-   それ以降：[AWS Cloud Practitioner Essentials (Second Edition) (Japanese): M3 – AWS の統合サービス | AWS トレーニングと認定](https://www.aws.training/Details/eLearning?id=34402)の内容
    -   AWS Elastic Beanstalk
    -   Amazon CloudFront
    -   AWS CloudFormation
